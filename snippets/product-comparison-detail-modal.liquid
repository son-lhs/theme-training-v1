<div
  x-data="
    {
      modalIsOpen: false,
      productHtml: '',
      async openModal() {
        this.modalIsOpen = true;
        if (!this.productHtml) {
          const res = await fetch('{{ product.url }}?view=ajax');
          this.productHtml = await res.text();
          this.$nextTick(() => {
            document.dispatchEvent(new CustomEvent('shopify:section:load', {
              detail: { section: this.$el.querySelector('[data-section-id]') }
            }));
          });
        }
      }
    }
  "
>
  <button
    @click="openModal()"
    type="button"
    class="lg:inline hidden text-xl underline text-gray-500"
  >
    View Details
  </button>

  <button
    @click="openModal()"
    type="button"
    class="lg:hidden w-full bg-green-700 text-white py-2 px-4 rounded-lg font-medium text-xl"
  >
    View Product
  </button>

  <div
    x-cloak
    x-show="modalIsOpen"
    x-transition:enter="ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    x-trap.noscroll="modalIsOpen"
    @keydown.esc.window="modalIsOpen = false"
    @click.self="modalIsOpen = false"
    class="fixed inset-0 z-50 overflow-y-auto bg-black/40 p-4 sm:p-6 lg:p-8 backdrop-blur-sm"
  >
    <div
      x-show="modalIsOpen"
      x-transition:enter="ease-out duration-300"
      x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
      x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
      x-transition:leave="ease-in duration-200"
      x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
      x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
      class="flex min-h-full items-end justify-center sm:items-center"
    >
      <div
        class="w-full max-w-4xl bg-white rounded-xl shadow-xl overflow-hidden"
        style="max-height: calc(100vh - 4rem);"
      >
        <div class="flex justify-between items-center p-4 border-b">
          <h2 class="text-xl font-bold">{{ product.title }}</h2>
          <button @click="modalIsOpen = false" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
        </div>

        <div
          class="overflow-y-auto p-6"
          style="max-height: calc(100vh - 120px);"
        >
          <div x-html="productHtml"></div>
        </div>
      </div>
    </div>
  </div>
</div>
